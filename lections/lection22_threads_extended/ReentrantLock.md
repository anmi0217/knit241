## **`ReentrantLock` –≤ Java: –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ `synchronized`**

`ReentrantLock` ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å –∏–∑ –ø–∞–∫–µ—Ç–∞ `java.util.concurrent.locks`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–≥–∏–±–∫–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** –ø–æ—Ç–æ–∫–æ–≤, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π `synchronized`, –Ω–æ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏.

---

## **1. –ó–∞—á–µ–º –Ω—É–∂–µ–Ω `ReentrantLock`?**

üîπ –í Java –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `synchronized`:

```java
public synchronized void method() {
    // –ö–æ–¥, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω
}
```

–ù–æ `synchronized` –∏–º–µ–µ—Ç **–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:

- **–ù–µ—Ç —Ç–∞–π–º-–∞—É—Ç–∞**: –Ω–µ–ª—å–∑—è –∑–∞–¥–∞—Ç—å –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.
- **–ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–µ—Ä–≤–∞—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**.
- **–ù–µ–ª—å–∑—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ –ø–æ—Ç–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É**.
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –º–µ—Ç–æ–¥–∞**.

üìå **–†–µ—à–µ–Ω–∏–µ:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ReentrantLock`, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–µ—Ç **–±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏**.

---

## **2. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `ReentrantLock`?**

üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

|–ú–µ—Ç–æ–¥|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|`lock()`|–ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É (–µ—Å–ª–∏ –∑–∞–Ω—è—Ç–∞ ‚Äì –ø–æ—Ç–æ–∫ –∂–¥–µ—Ç)|
|`unlock()`|–û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É|
|`tryLock()`|–ü—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É, –ù–ï –æ–∂–∏–¥–∞—è, –µ—Å–ª–∏ –æ–Ω–∞ –∑–∞–Ω—è—Ç–∞|
|`tryLock(timeout, TimeUnit)`|–ü—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –≤ —Ç–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏|
|`lockInterruptibly()`|–ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É, –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å –ø–æ—Ç–æ–∫|
|`isLocked()`|–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ –∫—Ç–æ-—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É|
|`isHeldByCurrentThread()`|–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É|

---

## **3. –ü—Ä–∏–º–µ—Ä: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ReentrantLock`**

```java
import java.util.concurrent.locks.ReentrantLock;

class SharedResource {
    private final ReentrantLock lock = new ReentrantLock();

    public void doWork() {
        lock.lock(); // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
        try {
            System.out.println(Thread.currentThread().getName() + " –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É...");
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock(); // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
        }
    }
}

public class ReentrantLockExample {
    public static void main(String[] args) {
        SharedResource resource = new SharedResource();

        Runnable task = resource::doWork;

        Thread t1 = new Thread(task, "–ü–æ—Ç–æ–∫ 1");
        Thread t2 = new Thread(task, "–ü–æ—Ç–æ–∫ 2");

        t1.start();
        t2.start();
    }
}
```

### **–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏–º–µ—Ä)**

```
–ü–æ—Ç–æ–∫ 1 –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É...
–ü–æ—Ç–æ–∫ 2 –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É...
```

üëâ `t2` –∂–¥–µ—Ç, –ø–æ–∫–∞ `t1` –æ—Å–≤–æ–±–æ–¥–∏—Ç `lock`.

---

## **4. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ `ReentrantLock`**

### **üîπ 4.1. –†–µ–µ–Ω—Ç–µ—Ä–∞–±–µ–ª—å–Ω–æ—Å—Ç—å (Reentrancy)**

üîπ **"Reentrant" –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –≤–ª–∞–¥–µ–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π, –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –µ–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ**.

üìå **–ü—Ä–∏–º–µ—Ä —Å `synchronized` (—Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–µ–Ω—Ç–µ—Ä–∞–±–µ–ª—å–Ω–æ):**

```java
public synchronized void outerMethod() {
    innerMethod(); // –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–æ—Ç –∂–µ –ø–æ—Ç–æ–∫
}

public synchronized void innerMethod() {
    // –ö–æ–¥
}
```

üìå **–¢–æ –∂–µ —Å–∞–º–æ–µ —Å `ReentrantLock`**:

```java
import java.util.concurrent.locks.ReentrantLock;

class ReentrantExample {
    private final ReentrantLock lock = new ReentrantLock();

    public void outerMethod() {
        lock.lock();
        try {
            System.out.println("–í–Ω–µ—à–Ω–∏–π –º–µ—Ç–æ–¥");
            innerMethod(); // –¢–æ—Ç –∂–µ –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç —Å–Ω–æ–≤–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å lock
        } finally {
            lock.unlock();
        }
    }

    public void innerMethod() {
        lock.lock();
        try {
            System.out.println("–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥");
        } finally {
            lock.unlock();
        }
    }
}
```

‚úÖ **–û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å `lock` –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑** –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

---

### **üîπ 4.2. `tryLock()` ‚Äì –ø–æ–ø—ã—Ç–∫–∞ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è**

–ò—Å–ø–æ–ª—å–∑—É–µ–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏–º **–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫** –Ω–∞ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.

```java
if (lock.tryLock()) {
    try {
        System.out.println("–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞!");
    } finally {
        lock.unlock();
    }
} else {
    System.out.println("–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–Ω—è—Ç–∞, –ø–æ—Ç–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...");
}
```

üîπ –ï—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ **–∑–∞–Ω—è—Ç–∞**, –ø–æ—Ç–æ–∫ –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é –ª–æ–≥–∏–∫—É.

---

### **üîπ 4.3. `tryLock(timeout, TimeUnit)` ‚Äì –æ–∂–∏–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å —Ç–∞–π–º-–∞—É—Ç–æ–º**

–ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å **–≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**.

```java
import java.util.concurrent.TimeUnit;
import java.util.concurrent.locks.ReentrantLock;

public class TryLockWithTimeout {
    private static final ReentrantLock lock = new ReentrantLock();

    public static void main(String[] args) {
        Thread t1 = new Thread(() -> tryToLock("–ü–æ—Ç–æ–∫ 1"));
        Thread t2 = new Thread(() -> tryToLock("–ü–æ—Ç–æ–∫ 2"));

        t1.start();
        t2.start();
    }

    private static void tryToLock(String name) {
        try {
            if (lock.tryLock(2, TimeUnit.SECONDS)) { // –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã
                try {
                    System.out.println(name + " –ø–æ–ª—É—á–∏–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫—É!");
                    Thread.sleep(3000);
                } finally {
                    lock.unlock();
                }
            } else {
                System.out.println(name + " –Ω–µ —Å–º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É!");
            }
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```

### **–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏–º–µ—Ä)**

```
–ü–æ—Ç–æ–∫ 1 –ø–æ–ª—É—á–∏–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫—É!
–ü–æ—Ç–æ–∫ 2 –Ω–µ —Å–º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É!
```

‚úÖ **–ï—Å–ª–∏ –ø–æ—Ç–æ–∫ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã, –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è.**

---

### **üîπ 4.4. `lockInterruptibly()` ‚Äì –º–æ–∂–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**

–ï—Å–ª–∏ –ø–æ—Ç–æ–∫ –∑–∞—Å—Ç—Ä—è–ª –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ `lock.lock()`, –µ–≥–æ **–Ω–µ–ª—å–∑—è –ø—Ä–µ—Ä–≤–∞—Ç—å**.  
–ù–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º **`lockInterruptibly()`**, –ø–æ—Ç–æ–∫ **–º–æ–∂–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å –≤–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è**.

```java
import java.util.concurrent.locks.ReentrantLock;

public class LockInterruptiblyExample {
    private static final ReentrantLock lock = new ReentrantLock();

    public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(() -> {
            try {
                lock.lockInterruptibly(); // –ú–æ–∂–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ
                try {
                    System.out.println("–ü–æ—Ç–æ–∫ 1 –ø–æ–ª—É—á–∏–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫—É!");
                    Thread.sleep(5000);
                } finally {
                    lock.unlock();
                }
            } catch (InterruptedException e) {
                System.out.println("–ü–æ—Ç–æ–∫ 1 –±—ã–ª –ø—Ä–µ—Ä–≤–∞–Ω –≤–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏!");
            }
        });

        Thread t2 = new Thread(() -> {
            try {
                Thread.sleep(1000);
                t1.interrupt(); // –ü—Ä–µ—Ä—ã–≤–∞–µ–º t1
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });

        t1.start();
        t2.start();
    }
}
```

### **–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

```
–ü–æ—Ç–æ–∫ 1 –±—ã–ª –ø—Ä–µ—Ä–≤–∞–Ω –≤–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏!
```

‚úÖ –ü–æ—Ç–æ–∫ 1 –æ–∂–∏–¥–∞–ª `lock`, –Ω–æ `t2` –µ–≥–æ **–ø—Ä–µ—Ä–≤–∞–ª**.

---

## **5. –í—ã–≤–æ–¥**

‚úÖ `ReentrantLock` –¥–∞–µ—Ç **–≥–∏–±–∫–æ—Å—Ç—å –∏ –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è**, —á–µ–º `synchronized`.  
‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç **–ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (`isLocked()`)**, **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–π–º–∞—É—Ç (`tryLock()`)**, **–ø—Ä–µ—Ä—ã–≤–∞—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ (`lockInterruptibly()`)**.  
‚úÖ **–†–µ–µ–Ω—Ç–µ—Ä–∞–±–µ–ª–µ–Ω** ‚Äì –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ.  
‚ùå **–ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –≤—ã–∑—ã–≤–∞—Ç—å `unlock()`**, –∏–Ω–∞—á–µ –≤–æ–∑–º–æ–∂–µ–Ω deadlock.

üìå **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ReentrantLock` –≤–º–µ—Å—Ç–æ `synchronized`?**

- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ **–≥–∏–±–∫–æ—Å—Ç—å (`tryLock()`, `lockInterruptibly()`)**.
- –ï—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ **–±—É–¥–µ—Ç –¥–æ–ª–≥–æ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è**.
- –ï—Å–ª–∏ –Ω—É–∂–µ–Ω **—Ç–∞–π–º–∞—É—Ç** –ø—Ä–∏ –∑–∞—Ö–≤–∞—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.
