## **6. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å `CyclicBarrier`**

### **–í —á–µ–º –æ—Ç–ª–∏—á–∏–µ –æ—Ç `CountDownLatch`?**

üîπ **–û–±–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ (`CountDownLatch` –∏ `CyclicBarrier`) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤, –Ω–æ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ü–µ–ª—è–º–∏:**

|–ú–µ—Ö–∞–Ω–∏–∑–º|–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ?|–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã|
|---|---|---|
|`CountDownLatch`|‚ùå –ù–µ—Ç (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π)|–ü–æ—Ç–æ–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –∑–∞–¥–∞—á–∏ –∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏ –≤—ã–∑—ã–≤–∞—é—Ç `countDown()`, –ø–æ–∫–∞ —Å—á–µ—Ç—á–∏–∫ –Ω–µ —Å—Ç–∞–Ω–µ—Ç 0. –û–∂–∏–¥–∞—é—â–∏–µ –ø–æ—Ç–æ–∫–∏ (`await()`) –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á.|
|`CyclicBarrier`|‚úÖ –î–∞ (–º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—ã–π)|–ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ä–∞–±–æ—Ç—É **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**, –æ–∂–∏–¥–∞—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –Ω–∞ –±–∞—Ä—å–µ—Ä–µ (`await()`). –ö–æ–≥–¥–∞ **–≤—Å–µ –ø–æ—Ç–æ–∫–∏** –¥–æ—Å—Ç–∏–≥–∞—é—Ç –±–∞—Ä—å–µ—Ä–∞, –æ–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.|

üìå **–ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ:** `CountDownLatch` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑**, –∞ `CyclicBarrier` –º–æ–∂–Ω–æ **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ**.

---

### **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `CyclicBarrier` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≥—Ä—É–ø–ø –ø–æ—Ç–æ–∫–æ–≤**

–í `CyclicBarrier` —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã **–¥–æ—Å—Ç–∏–≥–Ω—É—Ç—å –±–∞—Ä—å–µ—Ä–∞**, –ø—Ä–µ–∂–¥–µ —á–µ–º –æ–Ω–∏ —Å–º–æ–≥—É—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

1. **–°–æ–∑–¥–∞–Ω–∏–µ `CyclicBarrier`**:
    
    ```java
    CyclicBarrier barrier = new CyclicBarrier(3);
    ```
    
    –ó–¥–µ—Å—å **3 –ø–æ—Ç–æ–∫–∞** –¥–æ–ª–∂–Ω—ã –≤—ã–∑–≤–∞—Ç—å `await()`, –ø—Ä–µ–∂–¥–µ —á–µ–º –æ–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
    
2. **–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –≤—ã–∑—ã–≤–∞–µ—Ç `await()`**:
    
    ```java
    barrier.await(); // –ü–æ—Ç–æ–∫ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∑–¥–µ—Å—å, –ø–æ–∫–∞ –≤—Å–µ –Ω–µ —Å–æ–±–µ—Ä—É—Ç—Å—è
    ```
    
3. **–ö–æ–≥–¥–∞ –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –≤—ã–∑–≤–∞–ª–∏ `await()`**, –±–∞—Ä—å–µ—Ä "—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è", –∏ –ø–æ—Ç–æ–∫–∏ **–ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**.
    

---

### **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (`reset()`)**

`CyclicBarrier` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑**. –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –±–∞—Ä—å–µ—Ä–∞, –æ–Ω **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è**.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ **–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –±–∞—Ä—å–µ—Ä**, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `reset()`:

```java
barrier.reset();
```

–≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω –∏–∑ –ø–æ—Ç–æ–∫–æ–≤ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π.

---

### **–†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –ø–æ—Ç–æ–∫–∞—Ö**

üìå **–ó–∞–¥–∞—á–∞:** –£ –Ω–∞—Å –µ—Å—Ç—å **4 –ø–æ—Ç–æ–∫–∞**, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ä–∞–±–æ—Ç—É **–ø–æ—ç—Ç–∞–ø–Ω–æ**.  
–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –¥–æ–ª–∂–µ–Ω **–¥–æ–∂–¥–∞—Ç—å—Å—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö** –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞.

#### **üîπ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã**

1. **–°–æ–∑–¥–∞–µ–º `CyclicBarrier` –Ω–∞ 4 –ø–æ—Ç–æ–∫–∞.**
2. **–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–µ—Ä–≤—ã–π —ç—Ç–∞–ø —Ä–∞–±–æ—Ç—ã, –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç `await()`.**
3. **–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –≤—ã–∑–≤–∞–ª–∏ `await()`, –æ–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –∫–æ –≤—Ç–æ—Ä–æ–º—É —ç—Ç–∞–ø—É.**
4. **–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑.**

---

### **–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ —Å `CyclicBarrier`**

```java
import java.util.concurrent.BrokenBarrierException;
import java.util.concurrent.CyclicBarrier;

public class CyclicBarrierExample {
    public static void main(String[] args) {
        int numWorkers = 4;
        CyclicBarrier barrier = new CyclicBarrier(numWorkers, () -> {
            System.out.println("=== –í—Å–µ –ø–æ—Ç–æ–∫–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —ç—Ç–∞–ø! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º... ===");
        });

        for (int i = 1; i <= numWorkers; i++) {
            new Thread(new Worker(i, barrier)).start();
        }
    }
}

class Worker implements Runnable {
    private int id;
    private CyclicBarrier barrier;

    public Worker(int id, CyclicBarrier barrier) {
        this.id = id;
        this.barrier = barrier;
    }

    @Override
    public void run() {
        try {
            System.out.println("–ü–æ—Ç–æ–∫ " + id + " –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 1");
            Thread.sleep(1000 * id);
            System.out.println("–ü–æ—Ç–æ–∫ " + id + " –∂–¥–µ—Ç –Ω–∞ –±–∞—Ä—å–µ—Ä–µ...");
            barrier.await(); // –ñ–¥–µ—Ç –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö

            System.out.println("–ü–æ—Ç–æ–∫ " + id + " –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 2");
            Thread.sleep(1000 * id);
            System.out.println("–ü–æ—Ç–æ–∫ " + id + " –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É.");
        } catch (InterruptedException | BrokenBarrierException e) {
            e.printStackTrace();
        }
    }
}
```

---

### **–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏–º–µ—Ä)**

```
–ü–æ—Ç–æ–∫ 1 –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 1
–ü–æ—Ç–æ–∫ 2 –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 1
–ü–æ—Ç–æ–∫ 3 –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 1
–ü–æ—Ç–æ–∫ 4 –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 1
–ü–æ—Ç–æ–∫ 1 –∂–¥–µ—Ç –Ω–∞ –±–∞—Ä—å–µ—Ä–µ...
–ü–æ—Ç–æ–∫ 2 –∂–¥–µ—Ç –Ω–∞ –±–∞—Ä—å–µ—Ä–µ...
–ü–æ—Ç–æ–∫ 3 –∂–¥–µ—Ç –Ω–∞ –±–∞—Ä—å–µ—Ä–µ...
–ü–æ—Ç–æ–∫ 4 –∂–¥–µ—Ç –Ω–∞ –±–∞—Ä—å–µ—Ä–µ...
=== –í—Å–µ –ø–æ—Ç–æ–∫–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —ç—Ç–∞–ø! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º... ===
–ü–æ—Ç–æ–∫ 1 –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 2
–ü–æ—Ç–æ–∫ 2 –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 2
–ü–æ—Ç–æ–∫ 3 –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 2
–ü–æ—Ç–æ–∫ 4 –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 2
–ü–æ—Ç–æ–∫ 1 –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É.
–ü–æ—Ç–æ–∫ 2 –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É.
–ü–æ—Ç–æ–∫ 3 –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É.
–ü–æ—Ç–æ–∫ 4 –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É.
```

---

### **–†–∞–∑–±–æ—Ä –∫–æ–¥–∞**

üîπ **–°–æ–∑–¥–∞–µ–º `CyclicBarrier` –Ω–∞ 4 –ø–æ—Ç–æ–∫–∞.**

```java
CyclicBarrier barrier = new CyclicBarrier(4, () -> {
    System.out.println("=== –í—Å–µ –ø–æ—Ç–æ–∫–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —ç—Ç–∞–ø! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º... ===");
});
```

üìå **–í—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç** (`Runnable`) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –±–∞—Ä—å–µ—Ä–∞**.

üîπ **–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `await()`**

```java
System.out.println("–ü–æ—Ç–æ–∫ " + id + " –∂–¥–µ—Ç –Ω–∞ –±–∞—Ä—å–µ—Ä–µ...");
barrier.await(); // –ü–æ—Ç–æ–∫ –∂–¥–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
```

–ü–æ—Ç–æ–∫–∏ **–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è** –Ω–∞ `await()` **–¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –≤—Å–µ 4 –ø–æ—Ç–æ–∫–∞ –Ω–µ —Å–æ–±–µ—Ä—É—Ç—Å—è**.

üîπ **–ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `await()` –≤—Å–µ–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏, –æ–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç—É**

```java
System.out.println("–ü–æ—Ç–æ–∫ " + id + " –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∞–ø 2");
```

üîπ **–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–∞, `CyclicBarrier` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è**, –∏ –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å.

---

### **–í—ã–≤–æ–¥**

‚úÖ `CyclicBarrier` **—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤** –∏ **–ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞—Ä—å–µ—Ä**.  
‚úÖ **–ö–æ–≥–¥–∞ –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ `await()`, –æ–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–º–µ—Å—Ç–µ**.  
‚úÖ –ú–æ–∂–Ω–æ **–≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –±–∞—Ä—å–µ—Ä–∞** (–ø–µ—Ä–µ–¥–∞—á–∞ `Runnable`).  
‚ùå **–ï—Å–ª–∏ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π, `CyclicBarrier` –ª–æ–º–∞–µ—Ç—Å—è** (`BrokenBarrierException`).

---

üìå **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `CyclicBarrier`?**

- –ö–æ–≥–¥–∞ **–≥—Ä—É–ø–ø–∞ –ø–æ—Ç–æ–∫–æ–≤ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—ç—Ç–∞–ø–Ω–æ**.
- –ö–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è **–ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞—Ä—å–µ—Ä–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ **–º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö**).
- –ö–æ–≥–¥–∞ –ø–æ—Ç–æ–∫–∏ **–∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞** –∏ –¥–æ–ª–∂–Ω—ã —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**.

üöÄ **–ï—Å–ª–∏ –ø–æ—Ç–æ–∫–∏ –ù–ï –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞ –∏ –ø—Ä–æ—Å—Ç–æ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `CountDownLatch`.**