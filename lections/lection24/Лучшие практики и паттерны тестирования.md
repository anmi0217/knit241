### **6. Лучшие практики и паттерны тестирования**

Чтобы ваши тесты были **качественными, надёжными и легко поддерживаемыми**, следует придерживаться определённых **практик и паттернов**.

---

#### **6.1. TDD (Test-Driven Development - Разработка через тестирование)**

**Основная идея:**  
Писать тесты **до написания функционального кода**.

---

##### **Пошаговый процесс TDD:**
1. **Написание теста:**
    - Создайте тест, который описывает требуемое поведение.
    - Естественно, на этом этапе тест не пройдёт (RED).

2. **Написание минимального кода:**
    - Напишите код, который позволяет пройти тест.
    - Код может быть минимально корректным, главное — добиться прохождения теста (GREEN).

3. **Рефакторинг:**
    - Улучшите код, сохраняя все тесты проходящими (REFACTOR).
    - Применяйте паттерны проектирования и улучшайте архитектуру.

---

##### **Преимущества TDD:**
- Повышает надёжность кода.
- Помогает лучше понять требуемый функционал.
- Упрощает процесс рефакторинга.
- Улучшает покрытие кода тестами.

---

#### **6.2. BDD (Behavior-Driven Development - Разработка через поведение)**

**BDD** — расширение TDD, которое делает акцент на **поведение системы с точки зрения пользователя**.

---

##### **Основные моменты:**
- Описание тестов в виде историй пользователей (User Stories).
- Использование читаемых форматов (`Given-When-Then`).
- Упрощает взаимодействие между разработчиками, тестировщиками и бизнес-аналитиками.

---

##### **Пример BDD-сценария (на естественном языке):**
```
Feature: Услуги калькулятора
  Scenario: Сложение чисел
    Given калькулятор запущен
    When я складываю 2 и 3
    Then результат должен быть 5
```

---

#### **6.3. Чек-лист для хороших Unit тестов**

1. **Изолированные:**
    - Каждый тест проверяет только один метод/функцию.

2. **Быстрые:**
    - Unit тесты должны выполняться за миллисекунды.

3. **Повторяемые:**
    - Всегда дают одинаковый результат, независимо от порядка запуска.

4. **Документирующие:**
    - Названия тестов должны отражать их цель (`testAddReturnsCorrectSum`).

5. **Полные:**
    - Покрывают как стандартные, так и крайние случаи (пустые значения, null и т. д.).

6. **Минимизация использования моков:**
    - Моки должны использоваться только для изоляции от внешних зависимостей.

7. **Не зависят от внешнего окружения:**
    - Тесты не должны зависеть от базы данных, сети, файловой системы и т. д.

8. **Проверка результатов:**
    - Тесты должны содержать чёткие утверждения (`assert`).

---

#### **6.4. Антипаттерны тестирования**

1. **Тесты, зависящие от порядка выполнения:**
    - Никогда не стройте тесты так, чтобы их успешность зависела от порядка запуска.

2. **Чрезмерное использование моков:**
    - Не следует заменять всё на моки. Если моков слишком много, значит, тестируемый код слишком сложный.

3. **Игнорирование пограничных случаев:**
    - Например, пустые строки, null, большие значения и т. д.

4. **Сложные тесты:**
    - Тесты должны быть максимально простыми и понятными. Если тест сложный — возможно, код, который он проверяет, слишком сложный.

5. **Тестирование реализации, а не поведения:**
    - Тесты не должны полагаться на внутреннюю реализацию, которая может меняться. Лучше проверять поведение, а не код.

---

#### **6.5. Интеграция Unit тестов в процесс разработки**

1. **Частый запуск:**
    - Запускайте тесты локально перед коммитом.

2. **Автоматический запуск (CI/CD):**
    - Включайте Unit тесты в процесс CI/CD, чтобы они запускались при каждом изменении кода.

3. **Code Coverage:**
    - Измеряйте процент покрытия кода тестами (например, с использованием Jacoco).
    - Стремитесь к высокому покрытию, но не жертвуйте качеством.

4. **Рефакторинг через тестирование:**
    - Тесты позволяют безопасно улучшать код и добавлять новые функции.

---
