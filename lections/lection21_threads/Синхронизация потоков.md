# **3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤ –≤ Java**

### **–ü—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞**

–ö–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ **–æ–±—â–∏–º –¥–∞–Ω–Ω—ã–º** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫ –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π), –≤–æ–∑–Ω–∏–∫–∞–µ—Ç **–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø**. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ **—Å–æ—Å—Ç–æ—è–Ω–∏—é –≥–æ–Ω–∫–∏ (race condition)**, –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º.

#### **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞**

```java
class Counter {
    private int count = 0;

    public void increment() {
        count++;
    }

    public int getCount() {
        return count;
    }
}

public class RaceConditionExample {
    public static void main(String[] args) throws InterruptedException {
        Counter counter = new Counter();

        Thread t1 = new Thread(() -> {
            for (int i = 0; i < 10000; i++) {
                counter.increment();
            }
        });

        Thread t2 = new Thread(() -> {
            for (int i = 0; i < 10000; i++) {
                counter.increment();
            }
        });

        t1.start();
        t2.start();
        t1.join();
        t2.join();

        System.out.println("–ò—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: " + counter.getCount());
    }
}
```

### **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

`20000` (—Ç–∞–∫ –∫–∞–∫ –¥–≤–∞ –ø–æ—Ç–æ–∫–∞ –ø–æ 10000 —Ä–∞–∑ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç `count`).

### **–†–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –æ—à–∏–±–∫–∏):**

–ú–æ–∂–µ—Ç –±—ã—Ç—å **–º–µ–Ω—å—à–µ 20000**, —Ç–∞–∫ –∫–∞–∫ –¥–≤–∞ –ø–æ—Ç–æ–∫–∞ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞—Ç—å `count` –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

–≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞. –î–ª—è –µ–µ —Ä–µ—à–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç **—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é**.

---

### **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `synchronized`**

–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `synchronized` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫** –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ **—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞** –∏–ª–∏ **–º–µ—Ç–æ–¥–∞** –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.

#### **1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥**

```java
class SynchronizedCounter {
    private int count = 0;

    public synchronized void increment() {
        count++;
    }

    public synchronized int getCount() {
        return count;
    }
}

public class SynchronizedExample {
    public static void main(String[] args) throws InterruptedException {
        SynchronizedCounter counter = new SynchronizedCounter();

        Thread t1 = new Thread(() -> {
            for (int i = 0; i < 10000; i++) {
                counter.increment();
            }
        });

        Thread t2 = new Thread(() -> {
            for (int i = 0; i < 10000; i++) {
                counter.increment();
            }
        });

        t1.start();
        t2.start();
        t1.join();
        t2.join();

        System.out.println("–ò—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: " + counter.getCount());
    }
}
```

### **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- –ö–æ–≥–¥–∞ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç `increment()`, –¥—Ä—É–≥–æ–π **–∂–¥–µ—Ç**, –ø–æ–∫–∞ –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞.
- –¢–µ–ø–µ—Ä—å –∏—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ **20000**.

---

#### **2. –ë–ª–æ–∫ `synchronized`**

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ–≥–æ –º–µ—Ç–æ–¥–∞ –º–æ–∂–µ—Ç —Å–Ω–∏–∂–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫** –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞.

```java
class BlockSynchronizedCounter {
    private int count = 0;
    private final Object lock = new Object();

    public void increment() {
        synchronized (lock) { // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞
            count++;
        }
    }

    public int getCount() {
        return count;
    }
}
```

### **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `synchronized` –±–ª–æ–∫ –≤–º–µ—Å—Ç–æ –º–µ—Ç–æ–¥–∞?**

- –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ **—á–∞—Å—Ç—å –º–µ—Ç–æ–¥–∞** –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** —Ä–∞–∑–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏.

---

### **–ú–æ–Ω–∏—Ç–æ—Ä—ã –∏ –±–ª–æ–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**

–í Java **–∫–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç** —è–≤–ª—è–µ—Ç—Å—è **–º–æ–Ω–∏—Ç–æ—Ä–æ–º** (monitor). **–ú–æ–Ω–∏—Ç–æ—Ä** ‚Äì —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ä–µ—Å—É—Ä—Å—É.

#### **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–æ–≤**

- **`synchronized` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞**.
- –ï—Å–ª–∏ –º–µ—Ç–æ–¥ –æ–±—ä—è–≤–ª–µ–Ω –∫–∞–∫ `synchronized`, —Ç–æ **–º–æ–Ω–∏—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞** (–µ–≥–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞) –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –º–µ—Ç–æ–¥–∞.
- –ü–æ–∫–∞ **–æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç `synchronized` –º–µ—Ç–æ–¥**, –¥—Ä—É–≥–∏–µ **–∂–¥—É—Ç**.

#### **–ü—Ä–∏–º–µ—Ä —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏**

```java
class SharedResource {
    public synchronized void printMessage(String message) {
        System.out.print("[");
        try {
            Thread.sleep(100);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(message + "]");
    }
}

public class MonitorExample {
    public static void main(String[] args) {
        SharedResource resource = new SharedResource();

        Thread t1 = new Thread(() -> resource.printMessage("–ü—Ä–∏–≤–µ—Ç"));
        Thread t2 = new Thread(() -> resource.printMessage("–ú–∏—Ä"));
        Thread t3 = new Thread(() -> resource.printMessage("Java"));

        t1.start();
        t2.start();
        t3.start();
    }
}
```

### **–í—ã–≤–æ–¥ –±–µ–∑ `synchronized` (—Ä–∞–∑–æ—Ä–≤–∞–Ω–Ω—ã–π)**

```
[[[Java]
–ü—Ä–∏–≤–µ—Ç]
–ú–∏—Ä]
```

### **–í—ã–≤–æ–¥ —Å `synchronized` (–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π)**

```
[–ü—Ä–∏–≤–µ—Ç]
[–ú–∏—Ä]
[Java]
```

–ó–¥–µ—Å—å **–º–æ–Ω–∏—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞ `resource`** –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å **—Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –ø–æ—Ç–æ–∫—É** –∑–∞ —Ä–∞–∑.

---

### **–ü—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `synchronized` **–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö**, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–æ–≤—ã–º –ø—Ä–æ–±–ª–µ–º–∞–º:

1. **Deadlock (–≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)**
    
    - –î–≤–∞ –ø–æ—Ç–æ–∫–∞ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –∏ –Ω–µ –º–æ–≥—É—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
2. **Livelock (–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ)**
    
    - –ü–æ—Ç–æ–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç.
3. **Starvation (–≥–æ–ª–æ–¥–∞–Ω–∏–µ)**
    
    - –ï—Å–ª–∏ —É –ø–æ—Ç–æ–∫–∞ –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –æ–Ω –º–æ–∂–µ—Ç –Ω–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É.

#### **–ü—Ä–∏–º–µ—Ä Deadlock**

```java
class Resource {
    public synchronized void methodA(Resource other) {
        System.out.println(Thread.currentThread().getName() + " –∑–∞—Ö–≤–∞—Ç–∏–ª methodA");
        try { Thread.sleep(100); } catch (InterruptedException e) {}
        other.methodB(this);
    }

    public synchronized void methodB(Resource other) {
        System.out.println(Thread.currentThread().getName() + " –∑–∞—Ö–≤–∞—Ç–∏–ª methodB");
        try { Thread.sleep(100); } catch (InterruptedException e) {}
        other.methodA(this);
    }
}

public class DeadlockExample {
    public static void main(String[] args) {
        Resource r1 = new Resource();
        Resource r2 = new Resource();

        Thread t1 = new Thread(() -> r1.methodA(r2), "–ü–æ—Ç–æ–∫-1");
        Thread t2 = new Thread(() -> r2.methodA(r1), "–ü–æ—Ç–æ–∫-2");

        t1.start();
        t2.start();
    }
}
```

**–û–±–∞ –ø–æ—Ç–æ–∫–∞ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞, —Å–æ–∑–¥–∞–≤–∞—è `Deadlock`!**

### **–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å Deadlock?**

- **–°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ `synchronized` –º–µ—Ç–æ–¥—ã.**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `tryLock()` –∏–∑ `ReentrantLock` –≤–º–µ—Å—Ç–æ `synchronized`.**
- **–°–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.**

---

# **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤ –≤ Java: `wait()` –∏ `notify()`**

### **–ß—Ç–æ —Ç–∞–∫–æ–µ `wait()`, `notify()` –∏ `notifyAll()`?**

–ú–µ—Ç–æ–¥—ã `wait()`, `notify()` –∏ `notifyAll()` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç **–æ–¥–Ω–æ–º—É –ø–æ—Ç–æ–∫—É –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏ –∂–¥–∞—Ç—å**, –ø–æ–∫–∞ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ **–Ω–µ —Ä–∞–∑–±—É–¥–∏—Ç –µ–≥–æ**, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏.

üìå **–≠—Ç–∏ –º–µ—Ç–æ–¥—ã –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∫–ª–∞—Å—Å—É `Object`**, —Ç–∞–∫ –∫–∞–∫ –∫–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç –≤ Java —è–≤–ª—è–µ—Ç—Å—è –º–æ–Ω–∏—Ç–æ—Ä–æ–º –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

---

## **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç `wait()` –∏ `notify()`?**

- **`wait()`** ‚Äì –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –ø–æ—Ç–æ–∫ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è (WAITING) **–¥–æ –≤—ã–∑–æ–≤–∞ `notify()` –∏–ª–∏ `notifyAll()`**.
- **`notify()`** ‚Äì –ø—Ä–æ–±—É–∂–¥–∞–µ—Ç **–æ–¥–∏–Ω** –æ–∂–∏–¥–∞—é—â–∏–π –ø–æ—Ç–æ–∫.
- **`notifyAll()`** ‚Äì –ø—Ä–æ–±—É–∂–¥–∞–µ—Ç **–≤—Å–µ** –æ–∂–∏–¥–∞—é—â–∏–µ –ø–æ—Ç–æ–∫–∏.

> ‚ùó **–í–∞–∂–Ω–æ:** –ú–µ—Ç–æ–¥—ã `wait()` –∏ `notify()` **–¥–æ–ª–∂–Ω—ã –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ `synchronized` –±–ª–æ–∫–∞**, –∏–Ω–∞—á–µ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç `IllegalMonitorStateException`.

---

## **–ü—Ä–∏–º–µ—Ä: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å –∏ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å**

–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ **–æ–¥–∏–Ω –ø–æ—Ç–æ–∫ (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å) –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ**, –∞ **–¥—Ä—É–≥–æ–π (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å) –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏—Ö**. –û–Ω–∏ –¥–æ–ª–∂–Ω—ã **–∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞—Ç—å** —Å–≤–æ—é —Ä–∞–±–æ—Ç—É, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø—É—Å—Ç—ã–º–∏ –∏–ª–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

### **–ö–ª–∞—Å—Å `Store` (–æ–±—â–∏–π —Ä–µ—Å—É—Ä—Å)**

```java
class Store {
    private int product = 0;

    // –ú–µ—Ç–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
    public synchronized void produce() {
        while (product >= 5) { // –ú–∞–≥–∞–∑–∏–Ω –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω
            try {
                wait(); // –û–∂–∏–¥–∞–µ–º –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        product++;
        System.out.println("–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω —Ç–æ–≤–∞—Ä. –í—Å–µ–≥–æ –Ω–∞ —Å–∫–ª–∞–¥–µ: " + product);
        notify(); // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
    public synchronized void consume() {
        while (product <= 0) { // –ú–∞–≥–∞–∑–∏–Ω –ø—É—Å—Ç
            try {
                wait(); // –û–∂–∏–¥–∞–µ–º –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        product--;
        System.out.println("–ö—É–ø–ª–µ–Ω —Ç–æ–≤–∞—Ä. –û—Å—Ç–∞–ª–æ—Å—å –Ω–∞ —Å–∫–ª–∞–¥–µ: " + product);
        notify(); // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
    }
}
```

---

### **–ö–ª–∞—Å—Å `Producer` (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å)**

```java
class Producer extends Thread {
    private Store store;

    public Producer(Store store) {
        this.store = store;
    }

    @Override
    public void run() {
        for (int i = 0; i < 10; i++) {
            store.produce(); // –ü—Ä–æ–∏–∑–≤–æ–¥–∏–º —Ç–æ–≤–∞—Ä—ã
            try {
                Thread.sleep(500); // –°–∏–º—É–ª—è—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}
```

---

### **–ö–ª–∞—Å—Å `Consumer` (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å)**

```java
class Consumer extends Thread {
    private Store store;

    public Consumer(Store store) {
        this.store = store;
    }

    @Override
    public void run() {
        for (int i = 10; i > 0; i--) {
            store.consume(); // –ü–æ—Ç—Ä–µ–±–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã
            try {
                Thread.sleep(800); // –°–∏–º—É–ª—è—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–∫—É–ø–∫–∏
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}
```

---

### **–ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã**

```java
public class WaitNotifyExample {
    public static void main(String[] args) {
        Store store = new Store();

        Producer producer = new Producer(store);
        Consumer consumer = new Consumer(store);

        producer.start();
        consumer.start();
    }
}
```

---

## **–†–∞–∑–±–æ—Ä —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã**

1. **–ü–æ—Ç–æ–∫ `Producer` (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å)** —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–≤–∞—Ä –∏ **—É–≤–µ–¥–æ–º–ª—è–µ—Ç (`notify()`) –ø–æ—Ç–æ–∫ `Consumer`** –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏.
2. **–ü–æ—Ç–æ–∫ `Consumer` (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å)** –∑–∞–±–∏—Ä–∞–µ—Ç —Ç–æ–≤–∞—Ä –∏ **—É–≤–µ–¥–æ–º–ª—è–µ—Ç (`notify()`) –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è** –æ —Ç–æ–º, —á—Ç–æ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π.
3. –ï—Å–ª–∏ **–Ω–∞ —Å–∫–ª–∞–¥–µ –ø—É—Å—Ç–æ**, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –∂–¥–µ—Ç (`wait()`).
4. –ï—Å–ª–∏ **—Å–∫–ª–∞–¥ –ø–æ–ª–æ–Ω**, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å –∂–¥–µ—Ç (`wait()`).
5. **–ü–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–ø–µ—Ä–µ–º–µ–Ω–Ω–æ**, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö.

### **–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞**

```
–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω —Ç–æ–≤–∞—Ä. –í—Å–µ–≥–æ –Ω–∞ —Å–∫–ª–∞–¥–µ: 1
–ö—É–ø–ª–µ–Ω —Ç–æ–≤–∞—Ä. –û—Å—Ç–∞–ª–æ—Å—å –Ω–∞ —Å–∫–ª–∞–¥–µ: 0
–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω —Ç–æ–≤–∞—Ä. –í—Å–µ–≥–æ –Ω–∞ —Å–∫–ª–∞–¥–µ: 1
–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω —Ç–æ–≤–∞—Ä. –í—Å–µ–≥–æ –Ω–∞ —Å–∫–ª–∞–¥–µ: 2
–ö—É–ø–ª–µ–Ω —Ç–æ–≤–∞—Ä. –û—Å—Ç–∞–ª–æ—Å—å –Ω–∞ —Å–∫–ª–∞–¥–µ: 1
...
```

‚úÖ **–ë–ª–∞–≥–æ–¥–∞—Ä—è `wait()` –∏ `notify()`, –ø–æ—Ç–æ–∫–∏ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É –±–µ–∑ —Ö–æ–ª–æ—Å—Ç–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è.**

---

## **–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `notify()` –∏ `notifyAll()`**

- **`notify()`** ‚Äì –ø—Ä–æ–±—É–∂–¥–∞–µ—Ç **–æ–¥–∏–Ω —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ç–æ–∫** (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–∂–∏–¥–∞—é—Ç).
- **`notifyAll()`** ‚Äì –ø—Ä–æ–±—É–∂–¥–∞–µ—Ç **–≤—Å–µ –ø–æ—Ç–æ–∫–∏**, –Ω–æ —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –ø–æ–ª—É—á–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É** –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

### **–ü—Ä–∏–º–µ—Ä `notifyAll()`**

```java
public synchronized void produce() {
    while (product >= 5) {
        try {
            wait(); // –û–∂–∏–¥–∞–Ω–∏–µ, –µ—Å–ª–∏ —Å–∫–ª–∞–¥ –ø–æ–ª–æ–Ω
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
    product++;
    System.out.println("–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω —Ç–æ–≤–∞—Ä. –í—Å–µ–≥–æ –Ω–∞ —Å–∫–ª–∞–¥–µ: " + product);
    notifyAll(); // –ü—Ä–æ–±—É–∂–¥–∞–µ–º –≤—Å–µ—Ö –æ–∂–∏–¥–∞—é—â–∏—Ö –ø–æ—Ç–æ–∫–æ–≤
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `notifyAll()`?**

- –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –∂–¥—É—Ç —Ä–µ—Å—É—Ä—Å –∏ **–æ–¥–∏–Ω `notify()` –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ**, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `notifyAll()`.

---

## **–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `wait()` –∏ `notify()`**

‚ùå **–û—à–∏–±–∫–∞ 1: `wait()` –∏–ª–∏ `notify()` –±–µ–∑ `synchronized`**

```java
public void wrongMethod() {
    wait(); // –û—à–∏–±–∫–∞! –ë–µ–∑ synchronized –≤—ã–∑–æ–≤ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º
}
```

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```java
public synchronized void correctMethod() {
    try {
        wait();
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

‚ùå **–û—à–∏–±–∫–∞ 2: `notify()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –ø–æ—Ç–æ–∫ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –æ–∂–∏–¥–∞–Ω–∏–∏**

```java
public synchronized void method() {
    notify(); // –ü—Ä–æ–±—É–∂–¥–∞–µ–º –ø–æ—Ç–æ–∫, –Ω–æ wait() –µ—â–µ –Ω–µ –≤—ã–∑–≤–∞–Ω
}
```

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**  
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `wait()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–¥–æ `notify()`**.

---

## **–í—ã–≤–æ–¥**

- `wait()` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Ç–æ–∫—É **–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏ –∂–¥–∞—Ç—å**, –æ—Å–≤–æ–±–æ–∂–¥–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫—É.
- `notify()` –±—É–¥–∏—Ç **–æ–¥–∏–Ω** –ø–æ—Ç–æ–∫, `notifyAll()` ‚Äî **–≤—Å–µ** –æ–∂–∏–¥–∞—é—â–∏–µ –ø–æ—Ç–æ–∫–∏.
- –≠—Ç–∏ –º–µ—Ç–æ–¥—ã **–¥–æ–ª–∂–Ω—ã –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ `synchronized` –±–ª–æ–∫–∞**.
- –û–Ω–∏ –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è **–∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –ø–æ—Ç–æ–∫–æ–≤**, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∑–∞–¥–∞—á–∞—Ö **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å-–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å**.