# **üìå ThreadLocal –≤ Java**
### **–ß—Ç–æ —Ç–∞–∫–æ–µ `ThreadLocal`?**
`ThreadLocal<T>` ‚Äì —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π **–ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–∞–∂–¥–æ–º—É –ø–æ—Ç–æ–∫—É —Ö—Ä–∞–Ω–∏—Ç—å —Å–≤–æ–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥—Ä—É–≥–∏–º –ø–æ—Ç–æ–∫–∞–º.

**üîπ –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.**
- **–î—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏ –Ω–µ –≤–∏–¥—è—Ç —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ** (–∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤–æ–µ–π –∫–æ–ø–∏–µ–π).
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω–µ–ª—å–∑—è –ø—Ä–∏–º–µ–Ω—è—Ç—å `synchronized`, –Ω–æ –Ω—É–∂–Ω–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞.**

üìå **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ `ThreadLocal`:**  
‚úî –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—É –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Å–≤–æ–π ID).  
‚úî –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (—É –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Å–≤–æ–µ `Connection`).  
‚úî –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.

---

## **üîπ –ü—Ä–∏–º–µ—Ä 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ThreadLocal`**
```java
class ThreadLocalExample {
    private static final ThreadLocal<Integer> threadLocalValue = ThreadLocal.withInitial(() -> 0);

    public static void main(String[] args) {
        Runnable task = () -> {
            for (int i = 1; i <= 3; i++) {
                threadLocalValue.set(threadLocalValue.get() + 1);
                System.out.println(Thread.currentThread().getName() + " -> " + threadLocalValue.get());
            }
        };

        Thread t1 = new Thread(task, "–ü–æ—Ç–æ–∫ 1");
        Thread t2 = new Thread(task, "–ü–æ—Ç–æ–∫ 2");

        t1.start();
        t2.start();
    }
}
```

### **üìå –í—ã–≤–æ–¥ (–ø—Ä–∏–º–µ—Ä)**
```
–ü–æ—Ç–æ–∫ 1 -> 1
–ü–æ—Ç–æ–∫ 1 -> 2
–ü–æ—Ç–æ–∫ 1 -> 3
–ü–æ—Ç–æ–∫ 2 -> 1
–ü–æ—Ç–æ–∫ 2 -> 2
–ü–æ—Ç–æ–∫ 2 -> 3
```
‚úÖ –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –∏–º–µ–µ—Ç **—Å–≤–æ–µ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ** –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –æ–±—â–∏–π `ThreadLocal`.

---

## **üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**
–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ —Ö—Ä–∞–Ω–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ **—Å–≤–æ–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**, –¥–æ—Å—Ç—É–ø–Ω–æ–º —Ç–æ–ª—å–∫–æ —ç—Ç–æ–º—É –ø–æ—Ç–æ–∫—É.

üõ† **–ë–µ–∑ `ThreadLocal` –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –±—ã–ª–∞ –±—ã –æ–±—â–µ–π, –∏ –ø–æ—Ç–æ–∫–∏ –º–µ—à–∞–ª–∏ –±—ã –¥—Ä—É–≥ –¥—Ä—É–≥—É.**  
‚ö† **–í–∞–∂–Ω–æ:** `ThreadLocal` –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫–∏, –Ω–æ –∏–∑–æ–ª–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ.

---

## **üîπ –ü—Ä–∏–º–µ—Ä 2: `ThreadLocal` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
–î–æ–ø—É—Å—Ç–∏–º, –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —É –Ω–∞—Å –µ—Å—Ç—å **–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (`userId`), –∏ –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ "—Å–≤–æ–∏–º" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

```java
class UserContext {
    private static final ThreadLocal<String> userThreadLocal = new ThreadLocal<>();

    public static void setUser(String user) {
        userThreadLocal.set(user);
    }

    public static String getUser() {
        return userThreadLocal.get();
    }

    public static void clear() {
        userThreadLocal.remove();
    }
}

public class ThreadLocalUserExample {
    public static void main(String[] args) {
        Runnable task = () -> {
            String user = Thread.currentThread().getName().equals("–ü–æ—Ç–æ–∫ 1") ? "Alice" : "Bob";
            UserContext.setUser(user);

            System.out.println(Thread.currentThread().getName() + " —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º " + UserContext.getUser());

            UserContext.clear(); // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
        };

        Thread t1 = new Thread(task, "–ü–æ—Ç–æ–∫ 1");
        Thread t2 = new Thread(task, "–ü–æ—Ç–æ–∫ 2");

        t1.start();
        t2.start();
    }
}
```

### **üìå –í—ã–≤–æ–¥**
```
–ü–æ—Ç–æ–∫ 1 —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º Alice
–ü–æ—Ç–æ–∫ 2 —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º Bob
```
‚úÖ `ThreadLocal` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ **–∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**.

---

## **üîπ –†–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç–∏ `ThreadLocal`**
### **1Ô∏è‚É£ `ThreadLocal.withInitial()`**
–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å **–Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**.

```java
private static final ThreadLocal<Integer> counter = ThreadLocal.withInitial(() -> 1);
```
‚òë **–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –ø–æ–ª—É—á–∏—Ç `1`.**

---

### **2Ô∏è‚É£ `remove()`**
‚ö† **–í–∞–∂–Ω–æ –æ—á–∏—â–∞—Ç—å `ThreadLocal`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏!**

```java
threadLocal.remove(); // –£–¥–∞–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞
```

---

### **3Ô∏è‚É£ `InheritableThreadLocal`**
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ **–ø–æ—Ç–æ–∫-–ø–æ—Ç–æ–º–æ–∫** –¥–æ–ª–∂–µ–Ω —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ—Ç–æ–∫–∞.

```java
private static final InheritableThreadLocal<String> context = new InheritableThreadLocal<>();
```
‚òë –î–æ—á–µ—Ä–Ω–∏–µ –ø–æ—Ç–æ–∫–∏ **–Ω–∞—Å–ª–µ–¥—É—é—Ç** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–æ–¥–∏—Ç–µ–ª—è.

---

## **üîπ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ThreadLocal`?**
‚úÖ –ö–æ–≥–¥–∞ **–∫–∞–∂–¥–æ–º—É –ø–æ—Ç–æ–∫—É –Ω—É–∂–Ω—ã —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å).  
‚úÖ –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ **–∏–∑–±–µ–∂–∞—Ç—å `synchronized`** (–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ—Ç–æ–∫–æ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è).  
‚úÖ –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ **–±–∞–∑ –¥–∞–Ω–Ω—ã—Ö, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**.

‚ö† **–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**
‚ùå –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã –º–µ—Ç–æ–¥–∞** –≤–º–µ—Å—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.  
‚ùå –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ **–æ–±—â–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤** (`ThreadLocal` –¥–µ–ª–∞–µ—Ç –µ—ë –ª–æ–∫–∞–ª—å–Ω–æ–π).  
‚ùå –ï—Å–ª–∏ –∑–∞–±—ã—Ç—å –≤—ã–∑–≤–∞—Ç—å `remove()`, –≤–æ–∑–º–æ–∂–Ω—ã **—É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏**.

---

## **üîπ –í—ã–≤–æ–¥**
‚úÖ `ThreadLocal` –ø–æ–∑–≤–æ–ª—è–µ—Ç **–∫–∞–∂–¥–æ–º—É –ø–æ—Ç–æ–∫—É —Ö—Ä–∞–Ω–∏—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ—Ç–æ–∫–æ–≤**.  
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏, —Ä–∞–±–æ—Ç–µ —Å –ë–î, —Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö**.  
‚úÖ **–í–∞–∂–Ω–æ –æ—á–∏—â–∞—Ç—å `remove()`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏**.
